context.module("bbext").construct("appEvents",["events",function(a){return function(b){_.extend(b.prototype,{listen:function(){var c,d;this.stopListening();for(c in this.events){d=a[c];if(typeof d!=="function"){d=this[this.events[c]]}if(!d){continue}a.on(c,d,this)}},stopListening:function(){a.off(null,null,this)}});return b}}]);(function(){var d={displayError:function(e,f,h){var g=f&&f[e].join(",Â ");if(e){b(this,e,g,h)}else{c(this,g)}},displayErrors:function(f,g){var e=_.bind(this.displayError,this);if(g===undefined){g=true}if(f){_.each(_.keys(f),function(h){e(h,f,g)});return false}return true},isModelValid:function(e){e=e||this.model;return this.displayErrors(e.getErrors(),false)},listenForErrors:function(f){var e=this;f=f||this.model;this.listenTo(f,"error",function(h,g,i){if(g&&g.readyState){return}if($.isPlainObject(i)){e.displayErrors(g)}else{e.displayError(i,g)}})}};var b=function(j,e,g,i){var f,h;f=j.$("[data-validation-for]").filter(function(){return $(this).attr("data-validation-for").toLowerCase()===e.toLowerCase()});if(f.length===0){if(i){c(j,"An error occured with: "+e+" - "+g)}else{console.warn("There was an error on the model that cannot be displayed: "+e+" - "+g)}}h=f.closest(".form-field");if(g){h.addClass("error");a(f,g)}else{h.removeClass("error");f.html("")}},c=function(h,e){var f=h.$("form"),g=f.find(".alert-error");if(f.length===0||g.length===0){console.warn("A form or .alert-error element could not be found to display the error.")}if(e){f.addClass("error");a(g,"<h1>"+e+"</h1>")}else{f.removeClass("error");g.html("")}},a=function(e,f){var g=$.trim(e.html());if(g===f){e.fadeOut(function(){e.fadeIn()})}else{e.html(f)}};window.FormErrorHandler={extend:function(e,f){f=f||e.model;_.extend(e,{},d);if(f&&e.listenForErrors){e.listenForErrors(f)}}}}());(function(a){var b={modelGet:"get",modelSet:"set",types:{checkbox:{get:function(d){return d.is(":checked")},set:function(d,e){d.attr("checked",e)}},contenteditable:{event:["keydown","blur"],get:function(e,f,d){var g=this.model.get(d.name);if(f.type==="keydown"){if(f.keyCode==27){setTimeout(function(){e.blur()},0);e.text(g)}else{if(f.keyCode==13){e.blur();g=e.text();e.text(g)}}}else{g=e.text()}return g},set:function(d,e){d.html(e)}},multicheckbox:{get:function(d){var e=d.attr("name");var g=this.$el.find("[name='"+e+"']:checked");var f=_.map(g,function(h){return a(h).attr("value")});return f},set:function(e,g){var f=e.val();var d=_.any(g,function(h){return f===h});e.attr("checked",d)}},radio:{set:function(d,e){d.attr("checked",d.val()===e)}}},attributes:{id:"string",disabled:"boolean",checked:"boolean","class":"string",href:"string",text:"text",src:"string"},attributeTypes:{string:function(e,d,f){e.attr(d,f)},"boolean":function(e,d,f){if(!f){e.removeAttr(d)}else{e.attr(d,true)}},text:function(e,d,f){e.html(f)}}};var c=function(e,d){if(this instanceof c===false){return new c(e,d)}this.model=e;this.$el=a(d);if(this.$el.data("modelbound")===true){this.unbind()}this.$el.data("modelbound",true);this.bindings={};this._modelToViewProxy=a.proxy(this._modelToView,this);this.model.bind("change",this._modelToViewProxy);this._init();return this};c.prototype={model:null,$el:null,bindings:{},_init:function(){var d,e;e=a.proxy(this._viewToModelFromEvent,this);d=this.$el.find("[data-bind],[name],[id]");a.each(d,a.proxy(function(h,g){var i,j,f,k;g=a(g);i=g.attr("data-bind")||g.attr("name")||g.attr("id");if(!i){return}k=this.model[b.modelGet](i);if(k===undefined){return}j=g.attr("data-type")||g.attr("type")||g[0].tagName.toLowerCase();g.data("binding",{name:i,type:j});this._addBinding(i,g);f=this._getChangeEvent(g,j);if(f){_.each(f,function(l){g.bind(l+".modelbinder",e)})}this.updateEl(g,i,this.model[b.modelGet](i))},this));this._initAttrBindings();this._updateFromView()},_getChangeEvent:function(f,h){var e=b.types[h],g=(e&&e.event)||"change",d=f.attr("data-bind-event");g=d||g;return _.isArray(g)?g:[g]},_initAttrBindings:function(){a.each(b.attributes,a.proxy(function(d,f){var e=this.$el.find("[data-bind-"+d+"]");a.each(e,a.proxy(function(j,h){var k,g;h=a(h);k=h.attr("data-bind-"+d);g=h.data("binding")||{};if(!g.attrs){g.attrs={}}g.attrs[d]=k;h.data("binding",g);this._addBinding(k,h);this.updateEl(h,k,this.model[b.modelGet](k))},this))},this))},_updateFromView:function(){var d=this;setTimeout(function(){_.each(d.bindings,function(e,f){_.each(e,function(g){if(g.is(":text,:password,select")){d._viewToModel(g)}})})},500)},_addBinding:function(e,d){this.bindings[e]=this.bindings[e]||[];this.bindings[e].push(d)},_viewToModelFromEvent:function(d){this._viewToModel(a(d.target),d)},_viewToModel:function(e,f){var d=e.data("binding"),g,i,h;if(!d){return}g=(b.types[d.type]&&b.types[d.type].get)||function(j){return j.val()};i=g.call(this,e,f,d);if(i===""&&!this.model[b.modelGet](d.name)){h={silent:true}}this.model[b.modelSet](d.name,i,h)},_modelToView:function(e){var f,d,g;_.each(e.changed,function(i,h){f=h;d=this.bindings[f];if(d){g=e.get(f);a.each(d,a.proxy(function(k,j){this.updateEl(j,f,g)},this))}},this)},updateEl:function(e,f,h){var d,g;e=a(e);if(e.is(":focus")){return}d=e.data("binding");if(!d){this.unbind();return}h=h===null?"":h;if(d.name===f){g=(b.types[d.type]&&b.types[d.type].set)||function(i,j){i.is(":input")?i.val(j):i.html(String(j))};g.call(this,e,h)}if(d.attrs){a.each(d.attrs,a.proxy(function(i,k){var j,l;if(k===f){j=b.attributes[i];l=b.attributeTypes[j];l(e,i,h)}},this))}},unbind:function(){this.$el.find("[data-bind],[name],[id]").unbind(".modelbinder");this.model.unbind("change",this._modelToViewProxy);this.$el.data("modelbound",false)},off:function(){this.unbind()}};window.ModelBinder=c;c.config=b}(jQuery));context.module("bbext").shim("modelBinder",["$","_",function(a,b){return{render:function(d,f){var c,e=this._listeners||(this._listeners={});c=new ModelBinder(f,d);e[b.uniqueId("modelBinder")]=c}}}]);context.module("bbext").service("events",["globalCache",function(b){var a=b.get("bbextEvents");if(!a){a=_.extend({},Backbone.Events);b.set("bbextEvents",a)}return a}]);(function(){var a=context.module("bbext"),b=["context",function(c){return{create:function(d,e){return c.instantiate(d,[e])}}}];a.service("viewFactory",Array.prototype.slice.call(b,0));a.service("modelFactory",Array.prototype.slice.call(b,0));a.service("collectionFactory",Array.prototype.slice.call(b,0))}());context.module("bbext").service("modelErrors",function(){return{create:function(){return{hasErrors:false,errors:{},add:function(c,a){var b;this.hasErrors=true;if(arguments.length===1){a=arguments[0];c=""}b=this.errors[c]||[];b.push(a);this.errors[c]=b},toJSON:function(){return this.hasErrors?this.errors:undefined}}}}});var backupModelExt=(function(){var a={store:function(){this.memento=_.extend({},this.attributes);return this.memento},restore:function(b){if(this.memento){if(b){this.set(b,this.memento[b])}else{this.set(this.memento)}}return this.memento}};return{extend:function(b){_.extend(b,a)}}})();context&&context.module("bbext").service("bbext.backupModelExt",backupModelExt);var getSetModelExt=(function(){var a={get:function(d){var e,c=this[d]&&this[d].get,b=Backbone.Model.prototype.get.apply(this,arguments);if(_.isFunction(c)&&c!==a.get){e=c.call(this,b);if(e!==undefined){this.attributes[d]=e}}else{e=b}return e},set:function(e,g,f){var c=this,d,b=_.bind(function(h,j){var i=$.isPlainObject(this[h])&&this[h].set;j=_.isFunction(i)?i.call(this,j,f):j;return j},this);modelGetSetExt.setupInstance(this);if(_.isObject(e)){d={};f=arguments[1];_.each(arguments[0],function(i,h){d[h]=b(h,i)},this);Backbone.Model.prototype.set.call(this,d,f);return this}Backbone.Model.prototype.set.call(this,e,b(e,g),f);return this},toJSON:function(){var b={};var c=this;_.each(this.attributes,function(f,d){var e=c.get(d);e=e!==undefined?e:c.attributes[d];b[d]=e});return b},refresh:function(){this.set(this.toJSON())}};return{setupInstance:function(b){if(b._gsinit===true){return}b._bindings={};modelGetSetExt.parseBindings(b);modelGetSetExt.handleBindings(b);b._gsinit=true},parseBindings:function(b){$.each(b,function(c,e){var d;if(e&&e.bind&&_.isFunction(e.bind)===false){d=_.isArray(e.bind)?e.bind:[e.bind];_.each(d,function(f){b._bindings[f]=b._bindings[f]||[];b._bindings[f].push(c)})}})},handleBindings:function(b){b.on("all",function(c){var d=c&&c.split(":")[1];if(d&&this.attributes[d]!==undefined){_.each(this._bindings[d],function(e){this.set(e,this.get(e))},this)}})},extend:function(b){if(b._gsinit!==true){_.extend(b,a)}}}}());context&&context.module("bbext").service("bbext.getSetModelExt",getSetModelExt);var validationModelExt=(function(a,e){var c,d,b;c=function(f){a.each(f.changed,function(g,h){if(g){d(f,h)}})};d=function(h,i,j){var k,f=[],g=null;k=h[i]&&h[i].validate;if(h[i]&&!k){return null}a.each(k,function(l,o){var n=e.get(o),m;if(!n){throw"Validator does not exist: "+o}m=n.call(h,h.get(i),l);if(m){f.push(m)}});if(f.length>0){g={};g[i]=f;h._fieldErrors[i]=true;!j&&h.trigger("error",h,g,i)}else{if(!j&&h._fieldErrors[i]===true){h.trigger("error",h,g,i)}delete h._fieldErrors[i]}return g};b={getErrors:function(){if(!this._fieldErrors){this._fieldErrors={};this.on("change",a.bind(c,instance))}var h=this,f=null,g=h.toJSON(),i=h.validate&&h.validate(true);a.each(g,function(l,j){var k=d(h,j,true);if(k){f=a.extend(f||{},k)}});if(i){f=f||{};a.each(i,function(j,k){f[k]=a.union(f[k]||[],j)})}return f}};return{extend:function(f){a.extend(f,b)}}})();context&&context.module("bbext").service("bbext.validationModelExt",["_","validators",validationModelExt]);var closeViewExtension=(function(){var a={close:function(b){this.onClose&&this.onClose();this.undelegateEvents();this.off();this.stopListening();if(b&&b.remove===true){this.remove()}return this}};return{extend:function(b){_.extend(b,a)}}}());context&&context.module("bbext").service("bbext.closeViewExtension",closeViewExtension);var renderViewExtension=(function(a,d){var b,c,e={};a.templateSettings={interpolate:/\{\{(.+?)\}\}/g};c=function(h){var g=e[h],f;if(!g){f=$("#"+h).html();if(!f){throw"Template '"+h+"' not found"}g=a.template(f);e[h]=g}};b={render:function(){var f=this.model||this.collection,g=c(this.templateId);this.$el.html(g(f.toJSON()));d.render(this.$el,f);this.onRender&&this.onRender();return this}};return{extend:function(f){a.extend(f,b)}}});context&&context.module("bbext").service("bbext.renderViewExtension",["_","shims",renderViewExtension]);