context.module("bbext").construct("appEvents",["events",function(a){return function(b){_.extend(b.prototype,{listen:function(){var c,d;this.stopListening();for(c in this.events){d=a[c];if(typeof d!=="function"){d=this[this.events[c]]}if(!d){continue}a.on(c,d,this)}},stopListening:function(){a.off(null,null,this)}});return b}}]);(function(){var d={displayError:function(e,f,h){var g=f&&f[e].join(",Â ");if(e){b(this,e,g,h)}else{c(this,g)}},displayErrors:function(f,g){var e=_.bind(this.displayError,this);if(g===undefined){g=true}if(f){_.each(_.keys(f),function(h){e(h,f,g)});return false}return true},isModelValid:function(e){e=e||this.model;return this.displayErrors(e.getErrors(),false)},listenForErrors:function(f){var e=this;f=f||this.model;this.listenTo(f,"error",function(h,g,i){if(g&&g.readyState){return}if($.isPlainObject(i)){e.displayErrors(g)}else{e.displayError(i,g)}})}};var b=function(j,e,g,i){var f,h;f=j.$("[data-validation-for]").filter(function(){return $(this).attr("data-validation-for").toLowerCase()===e.toLowerCase()});if(f.length===0){if(i){c(j,"An error occured with: "+e+" - "+g)}else{console.warn("There was an error on the model that cannot be displayed: "+e+" - "+g)}}h=f.closest(".form-field");if(g){h.addClass("error");a(f,g)}else{h.removeClass("error");f.html("")}},c=function(h,e){var f=h.$("form"),g=f.find(".alert-error");if(f.length===0||g.length===0){console.warn("A form or .alert-error element could not be found to display the error.")}if(e){f.addClass("error");a(g,"<h1>"+e+"</h1>")}else{f.removeClass("error");g.html("")}},a=function(e,f){var g=$.trim(e.html());if(g===f){e.fadeOut(function(){e.fadeIn()})}else{e.html(f)}};window.FormErrorHandler={extend:function(e,f){f=f||e.model;_.extend(e,{},d);if(f&&e.listenForErrors){e.listenForErrors(f)}}}}());(function(a){var b={modelGet:"get",modelSet:"set",types:{checkbox:{get:function(d){return d.is(":checked")},set:function(d,e){d.attr("checked",e)}},contenteditable:{event:["keydown","blur"],get:function(e,f,d){var g=this.model.get(d.name);if(f.type==="keydown"){if(f.keyCode==27){setTimeout(function(){e.blur()},0);e.text(g)}else{if(f.keyCode==13){e.blur();g=e.text();e.text(g)}}}else{g=e.text()}return g},set:function(d,e){d.html(e)}},multicheckbox:{get:function(d){var e=d.attr("name");var g=this.$el.find("[name='"+e+"']:checked");var f=_.map(g,function(h){return a(h).attr("value")});return f},set:function(e,g){var f=e.val();var d=_.any(g,function(h){return f===h});e.attr("checked",d)}},radio:{set:function(d,e){d.attr("checked",d.val()===e)}}},attributes:{id:"string",disabled:"boolean",checked:"boolean","class":"string",href:"string",text:"text",src:"string"},attributeTypes:{string:function(e,d,f){e.attr(d,f)},"boolean":function(e,d,f){if(!f){e.removeAttr(d)}else{e.attr(d,true)}},text:function(e,d,f){e.html(f)}}};var c=function(e,d){if(this instanceof c===false){return new c(e,d)}this.model=e;this.$el=a(d);if(this.$el.data("modelbound")===true){this.unbind()}this.$el.data("modelbound",true);this.bindings={};this._modelToViewProxy=a.proxy(this._modelToView,this);this.model.bind("change",this._modelToViewProxy);this._init();return this};c.prototype={model:null,$el:null,bindings:{},_init:function(){var d,e;e=a.proxy(this._viewToModelFromEvent,this);d=this.$el.find("[data-bind],[name],[id]");a.each(d,a.proxy(function(h,g){var i,j,f,k;g=a(g);i=g.attr("data-bind")||g.attr("name")||g.attr("id");if(!i){return}k=this.model[b.modelGet](i);if(k===undefined){return}j=g.attr("data-type")||g.attr("type")||g[0].tagName.toLowerCase();g.data("binding",{name:i,type:j});this._addBinding(i,g);f=this._getChangeEvent(g,j);if(f){_.each(f,function(l){g.bind(l+".modelbinder",e)})}this.updateEl(g,i,this.model[b.modelGet](i))},this));this._initAttrBindings();this._updateFromView()},_getChangeEvent:function(f,h){var e=b.types[h],g=(e&&e.event)||"change",d=f.attr("data-bind-event");g=d||g;return _.isArray(g)?g:[g]},_initAttrBindings:function(){a.each(b.attributes,a.proxy(function(d,f){var e=this.$el.find("[data-bind-"+d+"]");a.each(e,a.proxy(function(j,h){var k,g;h=a(h);k=h.attr("data-bind-"+d);g=h.data("binding")||{};if(!g.attrs){g.attrs={}}g.attrs[d]=k;h.data("binding",g);this._addBinding(k,h);this.updateEl(h,k,this.model[b.modelGet](k))},this))},this))},_updateFromView:function(){var d=this;setTimeout(function(){_.each(d.bindings,function(e,f){_.each(e,function(g){if(g.is(":text,:password,select")){d._viewToModel(g)}})})},500)},_addBinding:function(e,d){this.bindings[e]=this.bindings[e]||[];this.bindings[e].push(d)},_viewToModelFromEvent:function(d){this._viewToModel(a(d.target),d)},_viewToModel:function(e,f){var d=e.data("binding"),g,i,h;if(!d){return}g=(b.types[d.type]&&b.types[d.type].get)||function(j){return j.val()};i=g.call(this,e,f,d);if(i===""&&!this.model[b.modelGet](d.name)){h={silent:true}}this.model[b.modelSet](d.name,i,h)},_modelToView:function(e){var f,d,g;_.each(e.changed,function(i,h){f=h;d=this.bindings[f];if(d){g=e.get(f);a.each(d,a.proxy(function(k,j){this.updateEl(j,f,g)},this))}},this)},updateEl:function(e,f,h){var d,g;e=a(e);if(e.is(":focus")){return}d=e.data("binding");if(!d){this.unbind();return}h=h===null?"":h;if(d.name===f){g=(b.types[d.type]&&b.types[d.type].set)||function(i,j){i.is(":input")?i.val(j):i.html(String(j))};g.call(this,e,h)}if(d.attrs){a.each(d.attrs,a.proxy(function(i,k){var j,l;if(k===f){j=b.attributes[i];l=b.attributeTypes[j];l(e,i,h)}},this))}},unbind:function(){this.$el.find("[data-bind],[name],[id]").unbind(".modelbinder");this.model.unbind("change",this._modelToViewProxy);this.$el.data("modelbound",false)},off:function(){this.unbind()}};window.ModelBinder=c;c.config=b;c.extend=function(d){_.extend(d,{bindModelToView:function(h,f){var e,g=this._listeners||(this._listeners={});f=f||this.$el;h=h||this.model||this.collection;e=new c(h,f);g[_.uniqueId("ModelBinder")]=e},bindTemplate:function(g,e,f){e=e||this.$el;f=f||this.model;this.template(g,e)(f.toJSON());this.bindModelToView(f,e)}})}}(jQuery));context.module("bbext").service("events",["globalCache",function(b){var a=b.get("bbextEvents");if(!a){a=_.extend({},Backbone.Events);b.set("bbextEvents",a)}return a}]);var bbext=context.module("bbext");var bbFactory=["context",function(a){return{create:function(b,c){return a.instantiate(b,[c])}}}];bbext.service("viewFactory",Array.prototype.slice.call(bbFactory,0));bbext.service("modelFactory",Array.prototype.slice.call(bbFactory,0));bbext.service("collectionFactory",Array.prototype.slice.call(bbFactory,0));var ModelErrors=function(){if(this instanceof ModelErrors===false){return new ModelErrors()}this.hasErrors=false;this.errors={};return this};ModelErrors.prototype={hasErrors:false,errors:{},add:function(c,a){var b;this.hasErrors=true;if(arguments.length===1){a=arguments[0];c=""}b=this.errors[c]||[];b.push(a);this.errors[c]=b},toJSON:function(){return this.hasErrors?this.errors:undefined}};var backupModelExt=(function(){var a={store:function(){this.memento=_.extend({},this.attributes);return this.memento},restore:function(b){if(this.memento){if(b){this.set(b,this.memento[b])}else{this.set(this.memento)}}return this.memento}};return{extend:function(b){_.extend(b,a)}}})();var getSetModelExt=(function(){var a={get:function(d){var e,c=this[d]&&this[d].get,b=Backbone.Model.prototype.get.apply(this,arguments);if(_.isFunction(c)&&c!==a.get){e=c.call(this,b);if(e!==undefined){this.attributes[d]=e}}else{e=b}return e},set:function(e,g,f){var c=this,d,b=_.bind(function(h,j){var i=$.isPlainObject(this[h])&&this[h].set;j=_.isFunction(i)?i.call(this,j,f):j;return j},this);modelGetSetExt.setupInstance(this);if(_.isObject(e)){d={};f=arguments[1];_.each(arguments[0],function(i,h){d[h]=b(h,i)},this);Backbone.Model.prototype.set.call(this,d,f);return this}Backbone.Model.prototype.set.call(this,e,b(e,g),f);return this},toJSON:function(){var b={};var c=this;_.each(this.attributes,function(f,d){var e=c.get(d);e=e!==undefined?e:c.attributes[d];b[d]=e});return b},refresh:function(){this.set(this.toJSON())}};return{setupInstance:function(b){if(b._gsinit===true){return}b._bindings={};modelGetSetExt.parseBindings(b);modelGetSetExt.handleBindings(b);b._gsinit=true},parseBindings:function(b){$.each(b,function(c,e){var d;if(e&&e.bind&&_.isFunction(e.bind)===false){d=_.isArray(e.bind)?e.bind:[e.bind];_.each(d,function(f){b._bindings[f]=b._bindings[f]||[];b._bindings[f].push(c)})}})},handleBindings:function(b){b.on("all",function(c){var d=c&&c.split(":")[1];if(d&&this.attributes[d]!==undefined){_.each(this._bindings[d],function(e){this.set(e,this.get(e))},this)}})},extend:function(b){if(b._gsinit!==true){_.extend(b,a)}}}}());
/*
 * ValidationModelExtension.js
 */
var validationModelExt=(function(){var a=function(d){_.each(d.changed,function(e,f){if(e){c(d,f)}})},c=function(f,g,h){var i,d=[],e=null;i=f[g]&&f[g].validate;if(f[g]&&!i){return null}_.each(i,function(j,m){var l=validationModelExt.validators[m],k;if(!l){throw"Validator does not exist: "+m}k=l.call(f,f.get(g),j);if(k){d.push(k)}});if(d.length>0){e={};e[g]=d;f._fieldErrors[g]=true;!h&&f.trigger("error",f,e,g)}else{if(!h&&f._fieldErrors[g]===true){f.trigger("error",f,e,g)}delete f._fieldErrors[g]}return e},b={getErrors:function(){validationModelExt.setupInstance(this);var f=this,d=null,e=f.toJSON(),g=f.validate&&f.validate(true);_.each(e,function(j,h){var i=c(f,h,true);if(i){d=_.extend(d||{},i)}});if(g){d=d||{};_.each(g,function(h,i){d[i]=_.union(d[i]||[],h)})}return d}};return{setupInstance:function(d){if(d._valinit===true){return}d._fieldErrors={};d.on("change",_.bind(a,d));d._valinit=true},extend:function(d){if(d._valinit!==true){_.extend(d,b)}},isNullOrEmpty:function(d){return !d||!$.trim(d)},validators:{required:function(f,d){var e=(d&&d.message)||"Required.";return this.isNullOrEmpty(f)?e:undefined},email:function(e){var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA;-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return(!this.isNullOrEmpty(e)&&_.isString(e)&&!e.match(d))?"Invalid email.":undefined},custom:function(e,d){return d(e)}}}})();(function(a){var b;b={close:function(){this.onClose&&this.onClose();this.undelegateEvents();this.off();this.stopListening();return this}};window.CloseViewExtension={extend:function(c){a.extend(c,b)}}}(_));(function(a,b){var c;b.templateSettings={interpolate:/\{\{(.+?)\}\}/g};c={renderTemplate:function(d){return this.template(d,this.$el)},template:function(e,d){var g,f=JstViewExtension.templates[e];if(!f){g=a("#"+e).html();if(!g){g=a("[data-template='"+e+"']").html();if(!g){throw"Template '"+e+"' not found"}}f=b.template(g);JstViewExtension.templates[e]=f}if(d){return function(h){return a(d).html(f(h))}}return f},JST:function(g,f){var d=a.Deferred(),e=[],h;h=c.template(g);f=b.clone(f)||{};b.each(f,function(j,k){var i;if(j&&j.then){i=a.Deferred();j.then(function(l){i.resolve({name:k,result:l})});e.push(i)}});a.when.apply(a,e).then(function(){var i=b.toArray(arguments);b.each(i,function(j){f[j.name]=j.result});d.resolve(h(f),f)});return d.promise()}};window.JstViewExtension={templates:{},extend:function(d){b.extend(d,c)}}}(jQuery,_));var bbext=context.module("bbext").use("appui");bbext.service("backupModelExt",backupModelExt);bbext.service("getSetModelExt",getSetModelExt);bbext.service("validationModelExt",validationModelExt);